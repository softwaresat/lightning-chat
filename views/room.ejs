<!DOCTYPE html>
<html>
    <head>
        
                <title>Lightning</title>

        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
          
                 <meta name="viewport" content="width=device-width, initial-scale=1">
                 <script src="https://code.jquery.com/jquery-1.11.1.js"></script>
<link rel="shortcut icon" type="image/jpg" href="https://media.discordapp.net/attachments/761286162333171734/904834737888198726/unknown.png"/>
<script 

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;500&display=swap" rel="stylesheet">
     <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

<style>
.sidenav {
white-space:nowrap;

margin-top: 50px;
float: right;
  height: 100%; /* Full-height: remove this if you want "auto" height */
   /* Set the width of the sidebar */
  position: fixed; /* Fixed Sidebar (stay in place on scroll) */
  z-index: 1; /* Stay on top */
  top: 0; /* Stay at the top */
  right: 0;
  background-color: #111; /* Black */
  overflow-x: hidden; /* Disable horizontal scroll */
  padding: 20px;

}

/* The navigation menu links */
.sidenav a {
  padding: 6px 8px 6px 16px;
  text-decoration: none;
  font-size: 25px;
  color: #818181;
  display: block;
}

/* When you mouse over the navigation links, change their color */
.sidenav a:hover {
  color: #f1f1f1;
}

html, body {
  overflow-x:hidden 
} 
  body{
    background-color: #3e505b;
    color: black;
    background: '#def28d'
    font-family: 'Roboto', sans-serif;
    font-weight:300;
    font-size: large;
  }
 
  .card-title{
    font-size: xx-large;
    background-color: "#731768"
  }
  .card{
  border-color: black;
  background-color: #19434d;
  margin-bottom: 1.25%;
border-radius: 20px;
color: #efefef;
  }
  li:hover{
    background-color:#86bbd8;
  }
  textarea{

     height: 100px;
    width: 80%;
    border-radius: 20px;
    background-color: #999999;
     display: block;
     margin-left: 2.5%;
         color: #000000;

  }
  input{
    border-radius: 20px;
    background-color: "#731768"
  }
  .buttons{
    visibility: hidden;
  }
  #formItem label {
    display: inline-block;
    text-align: center;
    line-height: 150%;
    font-size: .85em;
  }
  .label {
    text-align:center;
  }
  @media only screen and (max-width: 600px) {

  img{
    width: 100%;
    }
  #articles{
  margin-left: -20%;
  }
  #one{
  margin-top: 30%;
  }
 .ring{
 border-color: blue;
 color: black;
 }
 #form>input{
margin: 0 auto;
  margin-left: auto;
  margin-right: auto;
 }
 @media screen and (max-width: 600px) {
  .sidenav {
    visibility: hidden;

}
}
</style>
</head>
    <body>

    <div class="sidenav" style='background-color: #004766;'>
          <a href="/" style='font-size: 1em; color: white;'>Global Chat Room</a>

    <% author.forEach(function (result) { %>
           <% if(result.name == roomname){ %>

  <a href=<%="/room?name="+encodeURIComponent(result.name)%> style='font-size: 1em; color: black; background-color: white;'><%= result.name%></a>
       <% }else{ %>
         <a href=<%="/room?name="+encodeURIComponent(result.name)%> style='font-size: 1em; color: white;'><%= result.name%></a>
       <% } %> 

    <% }) %>
    <% other.forEach(function (result) { %>
<% if(result.name == roomname){ %>

  <a href=<%="/room?name="+encodeURIComponent(result.name)%> style='font-size: 1em; color: black; background-color: white;'><%= result.name%></a>
       <% }else{ %>
         <a href=<%="/room?name="+encodeURIComponent(result.name)%> style='font-size: 1em; color: white;'><%= result.name%></a>
       <% } %> 

    <% }) %>

 
</div>

     <nav class="navbar navbar-expand-lg fixed-top navbar-dark" style='background-color:#004766; margin-bottom: 20%;'>
  <div class="container-fluid">
    <a style="color: #ffd166;"class="navbar-brand" href="/">Lightning âš¡</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      
       <% if(loggedin == true){ %>
               <h5 class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" style='color: #b7b7b7;'aria-expanded="false">
            <%=name1%>
          </a>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
            <li><a class="dropdown-item" href="/account">Account</a></li>
             <li><a class="dropdown-item" href="/chatrooms">Chatrooms</a></li>
            <li><a class="dropdown-item" href="/newchatroom">New Chatroom</a></li>
                    <% if(item[0].type == 'Mod'){ %>

                                  <% } %>
            <li><a class="dropdown-item" href="/logout">Logout</a></li>
      


          </ul>
        </li>
              <% }else{ %>

      <form class="d-flex">
          <a class="btn btn-outline-success" style = 'margin-right: 5%;'href='/login'>Login</a>
        
      </form>
                    <% } %>
    </div>
  </div>
</nav>
     <script>
            function edit(id){
const firstchildEl = document.getElementById(id+'hi')
 firstchildEl.type = 'text'
 const text = document.getElementById(id)
 firstchildEl.value = text.innerHTML
 text.style.visibility = 'hidden';

const last = document.getElementById(id+'button')
last.style.visibility = 'visible'


            }
            function reply(id){
const firstchildEl = document.getElementById(id+'reply')
 firstchildEl.type = 'text'

const last = document.getElementById(id+'replybutton')
last.style.visibility = 'visible'


            }
          </script>
      



   

      


    <% var count = 0 %>

<% item.forEach(function (result) { %>
<% count++ %>
<% if(count == 1){ %>

  <div class="card" style="width: 100%;float:right;margin-top: 4%;">
    <div class="card-body" style = 'text-align:left;' id = "<%= result.id%>parent">

      <p><strong style="color: #b7b7b7;"><%= result.user %></strong>: <%= result.text %></p>

</div>
</div>
      
   
  </ul>
      
  
<div style="background-color: #731768;font-size: small;">


</div>
</div>

<% }else{ %>
<div class="card" style="width: 100%;float:right;">
    <div class="card-body" style = 'text-align:left;' id = "<%= result.id%>parent">

      <p><strong style="color: #b7b7b7;"><%= result.user %></strong>: <%= result.text %></p>

</div>
</div>
      
   
  </ul>
      
  
<div style="background-color: #731768;font-size: small;">


</div>
</div>
  <% } %>

    <%})%>
  <div id='messages'>

</div>
 <div style="color: #b7b7b7;"class="typing"></div>
    </div>
<form name="form" id='form' >
<div>


</div>
<link rel="stylesheet" href="/richtexteditor/rte_theme_default.css" />
<script type="text/javascript" src="/richtexteditor/rte.js"></script>
<script type="text/javascript" src='/richtexteditor/plugins/all_plugins.js'></script>
<input name = 'name' id = 'name' style="font-family:sans-serif;font-size:1em;"type='hidden' value = <%=name1%> required />
<input name = 'roomname' id = 'roomname' style="font-family:sans-serif;font-size:1em;"type='hidden' value = "<%=roomname%>" required />


<textarea name="comment" id="comment" style="margin-top: 3%;font-family:sans-serif;font-size:1em;"required></textarea>

<input type="hidden" id = 'author' name = 'author'value="<%=name1%>">  
<br>
<br>
<button style="display:none"id = 't'type="submit" value="Submit" class='btn btn-success'></button>
</form>

<script>

                $(document).scrollTop($(document).height());
// Get the input field
var input = document.getElementById("comment");

// Execute a function when the user releases a key on the keyboard
input.addEventListener("keyup", function(event) {
  // Number 13 is the "Enter" key on the keyboard
  if (event.keyCode === 13) {
    // Cancel the default action, if needed
    event.preventDefault();
    // Trigger the button element with a click
    document.getElementById("t").click();
  }
});

</script>
<script>
   function addMessages(message){
   if(message.chatroom == $('#roomname').val()){
   $("#messages").append(`
       <div class="card" style="width: 100%;float:right;">
    <div class="card-body" style = 'text-align:left;color:"#731768"'>

      <p><strong style="color: #b7b7b7;">${message.user}</strong>: ${message.text}</p>   
</div>
      `)
                $(document).scrollTop($(document).height());
                }

   }
  
   </script>
   <script src="/socket.io/socket.io.js"></script>

<script>
$(function (){
var socket = io()
var typing=false;
var timeout=undefined;
var user;
$(document).ready(function(){
      $('#comment').keypress((e)=>{
        if(e.which!=13){
          typing=true
          socket.emit('typing', {user:$('#name').val(), typing:true, chatroom: $('#roomname').val()})
          clearTimeout(timeout)
          timeout=setTimeout(typingTimeout, 3000)
        }else{
          clearTimeout(timeout)
          typingTimeout()
          //sendMessage() function will be called once the user hits enter
        }
      })

      //code explained later
      socket.on('display', (data)=>{
        if(data.typing==true && data.chatroom == $('#roomname').val())
          $('.typing').text(`${data.user} is typing...`)
        else
          $('.typing').text("")
      })
 })
$('form').submit(function(){
socket.emit('chatroom message', $('#comment').val(), $('#name').val(), $('#roomname').val());
$("#comment").val('');
return false;
})
});
</script>

        <script>
        
        var socket = io();

socket.on('chatroommessage', addMessages)
         function typingTimeout(){
    typing=false
    socket.emit('typing', {user:$('#name').val(), typing:false, chatroom: $('#roomname').val()})
}
        </script>   

    </body>
</html>   